QCLWM2M_DIR  := $(TOP)/SDK/PLAT/middleware/developed/iot

#CFLAGS_INC  +=  -I $(TOP)/SDK/PLAT/middleware/developed/iot/inc

CFLAGS += -DLWM2M_CLIENT_MODE -DENABLE_COMMON_ERR_LOG -DENABLE_COMMON_INFO_LOG -DLWM2M_LITTLE_ENDIAN -DLWM2M_STACK_SIZE=16384 -DLWM2M_PRIORITY=180\
				-DLWM2M_BOOTSTRAP -DLWM2M_SERVER_OBJECT -DCONNECTIVITY_STATS_ENHANCEMENT -DENABLE_CONN_STAT_OBJ\
				-DACL_ENHANCEMENTS -DEP_ATTR_FIX -DACL_OBJ_FIX -DBLOCK1_SUPPORT -DENABLE_FIRMWARE_OBJ -DENABLE_SOFTWARE_MGNT_OBJ\
				-DFACTORY_BOOTSTRAPPING -DDTLS_SUPPORT -DWMS_SMS_SUPPORT -DENABLE_DEVCAP_OBJ -DPSM_LWM2M -DENABLE_CONN_MONITOR\
				-DLOGGING_SUPPORT -DLWM2M_MDM_ENABLED -DENABLE_CELL_NW_CONN_OBJ\
				-DCOAP_STACK_SIZE=16384 -DCOAP_PRIORITY=50 -DAUTHORIZATION_SUPPORT -DENABLE_APN_CONN_OBJ


QCLWM2M_SRC_DIRS += $(QCLWM2M_DIR)/common/src
QCLWM2M_SRC_DIRS += $(QCLWM2M_DIR)/dtls/src
QCLWM2M_SRC_DIRS += $(QCLWM2M_DIR)/m2m/core/src
QCLWM2M_SRC_DIRS += $(QCLWM2M_DIR)/m2m/lwm2m/src
QCLWM2M_EXCLUDE_FILES := $(QCLWM2M_DIR)/m2m/core/src/list.c $(QCLWM2M_DIR)/m2m/lwm2m/src/location.c
QCLWM2M_CSRC = $(foreach dir, $(QCLWM2M_SRC_DIRS), $(wildcard $(dir)/*.c))
QCLWM2M_CFILES = $(filter-out $(QCLWM2M_EXCLUDE_FILES), $(QCLWM2M_CSRC))
QCLWM2M_COBJSTEMP := $(patsubst %.c, %.o, $(QCLWM2M_CFILES))
QCLWM2M_COBJSTEMP :=$(subst $(QCLWM2M_DIR),PLAT/middleware/developed/iot,$(QCLWM2M_COBJSTEMP))
QCLWM2M_COBJS := $(addprefix $(BUILDDIR)/, $(QCLWM2M_COBJSTEMP))

-include $(QCLWM2M_COBJS:.o=.d)

#$(ECHO) Objects QCLWM2M_COBJS

ifeq ($(TOOLCHAIN),GCC)

lib-y += libqclwm2m.a

$(BUILDDIR)/lib/libqclwm2m.a: $(QCLWM2M_COBJS)
	@mkdir -p $(dir $@)
	$(ECHO) AR $@
	$(Q)$(AR) -cr $@ $^

endif

ifeq ($(TOOLCHAIN),ARMCC)

lib-y += libqclwm2m.lib

$(BUILDDIR)/lib/libqclwm2m.lib: $(QCLWM2M_COBJS)
	@mkdir -p $(dir $@)
	$(ECHO) AR $@
	$(Q)$(AR) $(ARFLAGS) $@ $^

endif

